<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лабораторна робота №5</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
    <style>
        .item {
            margin: 10px;
            text-align: center;
        }
        .item img {
            max-width: 200px;
            max-height: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="d-flex justify-content-between align-items-center py-3">
            <h1>Каталог</h1>
            <nav>
                <a href="#" class="btn btn-primary" id="home">Додому</a>
                <a href="#" class="btn btn-secondary" id="catalog">Каталог</a>
            </nav>
        </header>
        <main id="content">
            <p>Ласкаво просимо до нашого магазину!</p>
        </main>
    </div>

    <script>
        async function fetchCategories() {
            try {
                const response = await fetch('categories.json');
                if (!response.ok) throw new Error('Failed to load categories.');
                return await response.json();
            } catch (error) {
                console.error(error);
                return [];
            }
        }

        async function fetchProducts(categoryShortname) {
            try {
                const response = await fetch(`${categoryShortname}.json`);
                if (!response.ok) throw new Error('Failed to load products.');
                return await response.json();
            } catch (error) {
                console.error(error);
                return [];
            }
        }

        document.getElementById("catalog").addEventListener("click", async () => {
            const content = document.getElementById("content");
            const categories = await fetchCategories();
            if (categories.length === 0) {
                content.innerHTML = "<p>Не вдалося завантажити категорії.</p>";
                return;
            }

            content.innerHTML = `<h2>Категорії</h2><ul class='list-group'>` +
                categories.map(category => `<li class='list-group-item'><a href='#' onclick='loadCategory("${category.shortname}")'>${category.name}</a></li>`).join("") +
                `<li class='list-group-item'><a href='#' onclick='loadRandomCategory()'>Specials</a></li></ul>`;
        });

        async function loadCategory(shortname) {
            const content = document.getElementById("content");
            const categories = await fetchCategories();
            const category = categories.find(cat => cat.shortname === shortname);

            if (!category) {
                content.innerHTML = "<p>Категорія не знайдена.</p>";
                return;
            }

            const products = await fetchProducts(shortname);

            content.innerHTML = `<h2>${category.name}</h2>` +
                `<p>${category.notes || ''}</p>` +
                `<div class='row'>` +
                products.map(item => `
                    <div class='col-md-3 item'>
                        <img src='${item.image}' alt='${item.name}'>
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <p>${item.price}</p>
                    </div>`).join("") +
                `</div>`;
        }

        async function loadRandomCategory() {
            const categories = await fetchCategories();
            if (categories.length === 0) {
                const content = document.getElementById("content");
                content.innerHTML = "<p>Не вдалося завантажити категорії для випадкового вибору.</p>";
                return;
            }

            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            loadCategory(randomCategory.shortname);
        }

        document.getElementById("home").addEventListener("click", () => {
            const content = document.getElementById("content");
            content.innerHTML = "<p>Ласкаво просимо до нашого магазину!</p>";
        });
    </script>
</body>
</html>
